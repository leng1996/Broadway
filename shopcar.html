<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="css/public.css"/>
		<link rel="stylesheet" type="text/css" href="css/shopcar.css"/>
		<style>
		
	 #car{width: 1000px;border:1px solid #000;margin: 0 auto;}
     #car .carhead{width: 1000px;height:60px;background: #ccc;line-height: 60px;}
     #car .carhead span:nth-child(2){margin-left: 20px;}
     #car .carhead span:nth-child(3){margin-left:360px;}
     #car .carhead span:nth-child(4){margin-left: 160px;}
     #car .carhead span:nth-child(5){margin-left: 138px;}
     #car .carhead span:nth-child(6){margin-left: 60px;}
     #car .cartail{height: 40px;background: #ddd;line-height: 40px;}
	 #car .cartail a{text-decoration: none;color: #000;cursor: pointer;}
     #car .cartail a:nth-child(2){margin-left: 80px;}
	 #car .cartail .t2{margin-left: 450px;}
     #car .cartail .t3{margin-left: 40px;}
     #car .cartail .t4{margin-left: 60px;}
     #car .cartail .t6{color:red;}
     #car .carbody{border-bottom: 1px solid #ccc;}
     #car .carbody .body{height: 80px;margin-bottom:10px;border-bottom: 1px solid #ccc;}
     #car .carbody .t1{width: 320px;display: inline-block;margin-left: 0px;font-size: 16px;color: #ccc;}
     #car .carbody #t2{margin-left: 110px;}
     #car .carbody .t3{margin-left: 0px;}
     #car .carbody .t4{margin-left: 0px;}
     #car .carbody .t5{margin-left: 100px;}
     #car .carbody .btnmt{margin-left: 81px;width: 110px;float: left;height: 60px;line-height: 60px;}
     #car .carbody .pric{margin-left: 0px;width: 90px;float: left;height: 60px;line-height: 60px;}
     #car .carbody .msg{margin-left: 0px;width: 350px;float: left;height: 60px;line-height: 60px;}
	 #car .carbody .imga{margin-left: 0px;width: 70px;float: left;height: 60px;line-height: 60px;}
     #car .carbody .chose{margin-left: 0px;width: 30px;float: left;height: 60px;line-height: 60px;}
     #car .carbody .unit{margin-left:99px;width: 90px;float: left;height: 60px;line-height: 60px;}
     #car .carbody .cut{margin-left:0px;width: 60px;float: left;height: 60px;text-align:center;line-height: 60px;}
     #car .carbody img{width: 40px;height: 30px;}
		
		</style>
	</head>
	<body>
		<!--top-->
		<div id="top">
			<div class="margin">
				<div class="top-l">
					<p>百商汇旗下全渠道电商平台</p>
					<a href="#">网站导航
						<img src="./imgs/dsj.png" alt="小三角">
					</a>
					<a href="index.html">首页</a>
				</div>
				<div class="top-r">
					<p>我的订单</p>
					<span>|</span>
					<p>我的百联</p>
					 <span>|</span>
					<p>充值缴费</p>
					<span>|</span> 
					<p>客服服务</p>
					<span>|</span> 
					<p>掌上百联</p>
					<span>|</span>
					<p>购物车</p>
				</div>
			</div>
		</div>
		
		<!--header-->
		<div id="header">
			<div class="margin">
				<div class="header-l">
					<img src="https://res12.iblimg.com/respc-1/resources/v4.2/css/i/logo-1.png"/>
					<img src="http://img23.iblimg.com/market-2/images/activity/1744576793.png"/>
				</div>
				<div class="header-c">
					<!--<input type="search" id="" value="" placeholder="" />-->
					
	<!--关键字搜索-->
					<div id="search">
						<input type="text" id="txt">
						<button>搜索</button>
						<ul class="search-res" id="list">
							
						</ul>
					</div>
					
					
					<!--<div class="x2">
						<a href="#">搜索</a>					
					</div>-->
					<div class="x3">
						<a href="#" class="tea">surface</a>
						<span>|</span>
						<a href="#">洗面奶</a>
						<span>|</span>
						<a href="#">耳机</a>
						<span>|</span>
						<a href="#">抽纸</a>
						<span>|</span>
						<a href="#">奶粉</a>
						<span>|</span>
						<a href="#">牙刷</a>
						<span>|</span>
						<a href="#">汤圆</a>
						<span>|</span>
						<a href="#">红酒</a>
						<span>|</span>
						<a href="#">荣耀</a>
						<span>|</span>
						<a href="#">小米9</a>
					</div>
				</div>
				<div class="header-r">
					<a href="https://www.okcard.com/?bl_mmc=YXTF_-_baiduPC_-_MD1556098276357_-_0">支付宝/微信支付<img src="./imgs/dsj.png" alt="小三角"></a>
				</div>
			</div>
		</div>
		
	<!--购物车页面-->	

	
	<div class="margin">
        <div id="car">
            <div class="carhead">
                <span><input type="checkbox" class="checkboxall"/>全选</span>
                <span>商品</span>
                <span>单价</span>
                <span>数量</span>
                <span>小计</span>
                <span>操作</span>
            </div>
            <!-- 数据的渲染 -->
            <div class="carbody">
                            <!-- <div class="body">
                            <div class="chose">
                            <input type="checkbox"/>
                            </div>
                            <div class="imga">
                            <img src="">
                            </div>
                            <div class="msg">
                            <span  class="">
                            海澜之家/Heilan Home春装商务白衬衫男修身HNCAD3A067Y 漂白(69) 漂
                            </span>
                            </div>
                            <div class="pric">
                            <span class="price"> &yen;138.00</span>
                            </div>
                            <div class="btnmt">
                            <button class="small-button t2">-</button>
                            <input class="center count" type="text" size="2" value="1">
                            <button class="small-button">+</button>
                            </div>
                            <div class="unit ">
                            <span class="priceCount t3">  &yen;138.00</span>
                            </div>
                            <div class="cut">
                            <a href="javascript:void(0);" class="t4">删除</a>
                            </div>
                        </div> -->
            </div>
            <div class="cartail">
                <a>删除选中商品</a>
                <span class="t2">总共选中了<span class="t6"id="toalCount">0</span>件商品</span>
                <span class="t4">总计：<span class="t6"id="toalPrice">￥0.00</span></span>
                <a href="#" class="t3">去结算</a>
            </div>
    </div>
		
	</body>
	<!--<script src="libs/jquery.2.2.4.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/ajax.3.0.js" type="text/javascript" charset="utf-8"></script>
	<script src="libs/cookie.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/shopcar.js" type="text/javascript" charset="utf-8"></script>-->
	<script src="js/ajax.js"></script>
	<script src="libs/cookie.js"></script>
	<!-- <script src="module/require.js" type="text/javascript" data-main="module/shopcar-module"></script> -->
	<script>
	

//数量加减
//function add(){
//		this.init();
//	}
//	
//	add.prototype.init = function(){
//			var i = 1;
//			$(".cont").children().eq(0).on("click",function(){
//				console.log($(".cont").children("input").val())
//				if($(".cont").children("input").val() == 1){
//					$(".cont").children("input").val(1) 
//				}else{
//					$(".cont").children("input").val(--i) 
//				}
//			})
//			
//			$(".cont").children().eq(2).on("click",function(){
//				if($(".cont").children("input").val() == 10){
//					$(".cont").children("input").val(10)
//				}else{
//					$(".cont").children("input").val(++i)
//				}
//			})
//	};
//	
//	
//	new add()

 
 
//    class shopcar{
//    	constructor(options){
// // 		1.解析参数
// 		this.shop = options.shop;
// 		this.url = options.url;
// 		this.shopul = options.shopul;
// 		this.shopulli = options.shopulli;
// //		console.log(this.shop)
// //		console.log(this.shopulli)
	
// //		2.请求数据
// 		this.load()
		
// //		5.绑定事件
// 		this.addEvent()
		
		
//    	}
   	
   	
//    	load(){
// // 		console.log(1)
//    		var that = this;
//    		$.ajax({
//    			url:this.url,
//    			success:function(res){
//      				that.res = res;
//      				// console.log(that.res)
// // 				that.res = JSON.parse(res);
//    				that.getCookie();
// // 				console.log(that.res)
// // 			3.请求数据成功后渲染页面
// // 				that.display();
//    			}
// // 			error:function(){				
// // 			}	
//    		})	
//    	}
   	
//    	getCookie(){
// // 		console.log(getCookie("goods"))
//    		this.goods = JSON.parse(getCookie("goods"));
// 		// console.log(this.goods)
// //console.log(this.res)
// //console.log(this.goods)
//    		this.display();
//    	}
   	
   
//    	display(){
// // 		4.遍历数据 拼接解构 渲染页面
// //		console.log(1)
//    		var str = "";
// // 		比对cookie和总数据
//    		for(var i=0;i<this.res.length;i++){
// 			//    console.log(1)
// 			for(var j=0;j<this.goods.length;j++){
// 								// console.log(this.goods.length)
// 								// console.log(this.goods[i].id,this.res[j].id)
// 								// console.log(this.goods[j].id)

							
// 				if(this.res[i].id == this.goods[j].id){
// 					// console.log(this.goods[j].id)
// 					// console.log(1)
// // // 					console.log(this.res[i])
// 		   			// str += `<li good="${this.res[i].id}">
// 					// 			<input type="checkbox" name="" id="" value="" />
// 					// 			<img src="${this.res[i].src}"/>
// 					// 			<p>${this.res[i].a1}</p>
// 					// 			<span>${this.res[i].a2}</span>
							
// 					// 			<div class="cont">
// 					// 				<i>-</i>
// 					// 				<input class="nbtn" type="number" name="" id="" value="1" min = "1"/>
// 					// 				<i>+</i>
// 					// 			</div>
// 					// 			<b id="del" index="${this.res[i].id}">删除</b>    
// 					// 		</li>`;
// 				   }
				   
//    			}
//    		}
//    		// this.shopul.innerHTML = str;
//    		this.addEvent()
//    	}
   	
//    		addEvent(){
// 			   var that = this;
			   
//    			this.shopul.addEventListener("click",function(eve){
// 				//    console.log(1)
//    				var e = eve || window.event;
// 				   var target = e.target || e.srcElement;
// 				//    setCookie("luke1","123")
// 				//    console.log(getCookie("luke1")) 
// 				//    console.log(getCookie("goods")) 
// 				//    that.display()
//    				if(target.id == "del"){
//    					console.log(target);
//    					that.id = eve.target.getAttribute("index");
// //						删除DOM元素
// 						eve.target.parentNode.parentNode.remove();
// //						6.遍历cookie,找到符合条件的数据,做删除
// 						that.changeCookie(function(index){
// //							8.删除并再次设置回去
// 							that.goods.splice(index,1);
// 							// 再次刷新网页
// 							location.reload([true])  
// 						})
//    				}

// 			   })		
			  
//    	}
   	
//    	changeCookie(callback){
// //				7.找到cookie中符合条件的数据
// 				for(var i=0;i<this.goods.length;i++){
// 					if(this.goods[i].id == this.id){
// 						break;
// 					}
// 				}
				
// 				callback(i);
				
// //				9.再设置回去
// //				12.再设置回去
// 				setCookie("goods",JSON.stringify(this.goods))
				
// 			}
   	
   	   	 	
   	 	
//    }

// 		new shopcar({
// 			shop:document.querySelector(".shop-3"),
// 			shopul:document.querySelector(".shop-3 ul"),
// 			url:"./json/goods.json"
// 	})




class car{
	constructor(){
		//完成数据的渲染
		this.body=document.querySelector(".carbody");
		console.log(this.body)
		this.url="json/goods.json";
		this.init()
		//绑定事件完成删除的功能
		this.addEvent(); 
	}
	addEvent(){
		var that=this;
	  
		this.body.onclick=function(e){
			var e=event||window.event;
			var target=e.target||e.srcElement;
			//删除功能
			if(target.className=="t4 del"){
				//获取点击对应的商品的id;
				that.id=target.parentNode.parentNode.getAttribute("index");
				//删除dom的节点
				// console.log(target.parentNode.parentNode)
				target.parentNode.parentNode.remove();
				//需要清除localStorage数据
				that.changeCookie(
					function(i){
					that.goods.splice(i,1);
					location.reload([true]) 
				}
				);

				that.sum()

			}
			//商品数量的功能
			if(target.className=="small-button"){
				} 
			if(target.className=="check"){
				// console.log(target.className)
				that.sum()
			  }        
			}
	   }
	   changecount(){
		   var countButtons=document.querySelectorAll("#car .small-button")
		   var that=this;
		   for(var i=0;i<countButtons.length;i++){
			   countButtons[i].onclick=function(e){
				var e=event||window.event;
				var target=e.target||e.srcElement;
				if(target.textContent=="+"){
				  var figure=target.previousElementSibling.value;
				  if(target.previousElementSibling.value<=999){
					target.previousElementSibling.value=parseInt(target.previousElementSibling.value)+1;
					}
				 // console.log(target.previousElementSibling.value)
				  }else{
					if(target.nextElementSibling.value >= 2){
					  target.nextElementSibling.value = parseInt(target.nextElementSibling.value) - 1;
						 }
		
					// console.log(target.nextElementSibling.value)
				 }
		
				var price=target.parentNode.parentNode.querySelector(" .price");
				var contprice=target.parentNode.parentNode.querySelector(".priceCount");
				var input=target.parentNode.parentNode.querySelector(".count").value;
				 var newprice=parseInt(price.textContent.slice(1,price.textContent.length))*input;
				//  console.log(newprice)
				 contprice.innerHTML=newprice;
				 // 设置商品的数量

				 that.id=target.parentNode.parentNode.getAttribute("index");
			
				 console.log(
					 that.changeCookie(
					
						 function(i){
							console.log(that.goods[i])
							 that.goods[i].num=parseInt(input);
							 console.log(that.goods[i])
							 }
					 )
				 )

				 that.sum()
			   }
		   }
	   }
	  
	changeCookie(callback){
//				7.找到cookie中符合条件的数据
			for(var i=0;i<this.goods.length;i++){
				if(this.goods[i].id == this.id){
					break;
				}
			}	
			callback(i);
			
//				9.再设置回去
//				12.再设置回去
			setCookie("goods",JSON.stringify(this.goods))
			
		}
   	
	   all(){
		   var that=this;
			 //全选
			//  this.divs=document.querySelectorAll(".body");
			var allcheck=document.querySelector(".checkboxall");
			//  console.log(allcheck)
			var checkBoxs = document.querySelectorAll('#car .check');
			// console.log(checkBoxs)
			// console.log(allcheck.checked)
			allcheck.onclick=function(){
				if(allcheck.checked){
					for(var i=0;i<checkBoxs.length;i++){
						if(!checkBoxs[i].checked){
							checkBoxs[i].checked=true;
						}
					}
				}else{
					for(var i=0;i<checkBoxs.length;i++){
						console.log(checkBoxs[i].checked)
						if(checkBoxs[i].checked){
							checkBoxs[i].checked=false;
						}
					}
				}
		  //数据的总和
		//   console.log(1010)
		  that.sum();
	 }
	}
	sum(){
		 //单选和数据总和
		 console.log(1)
		 var divs=document.querySelectorAll(".body");
		 var count=0;//总数
		 var sumPrice=0;//总价
		 for(var i=0;i<divs.length;i++){
		//  console.log(divs[i].querySelector("#car .check").checked)
		if(divs[i].querySelector(".check").checked){
		// console.log(divs[i].querySelector(".count").value)
		 count+=parseInt(divs[i].querySelector(".count").value);
		 sumPrice+=parseInt(divs[i].querySelector(".priceCount").innerHTML);
			}
		} 
		// console.log(count)  
		// console.log(sumPrice)  
		 document.querySelector("#toalCount").innerHTML=parseInt(count);
		 document.querySelector("#toalPrice").innerHTML='￥'+sumPrice.toFixed(2);
	}
	render(){
		this.initial=document.querySelectorAll("#priceCount");
		this.price=document.querySelectorAll(" .price");
		this.contprice=document.querySelectorAll(".priceCount");
		this.input=document.querySelectorAll(".count");
	   for(var i=0;i<this.initial.length;i++){
			// console.log(input)
			// //计算显示数据
			var newprice=parseInt(this.price[i].textContent.slice(1,this.price[i].textContent.length))*this.input[i].value;
			// console.log(newprice)
			this.contprice[i].innerHTML=newprice;
		}

	}


	init(){
		var that=this;
		ajaxPost(this.url,function(res){
		   that.res=JSON.parse(res);
		   console.log(that.res)
		   that.getCookie();
		//    that.getData();
		})
	}
	getCookie(){
		console.log(11)
		console.log(getCookie("goods"))
		   		this.goods = JSON.parse(getCookie("goods"));
				console.log(this.goods)
			console.log(this.res)
		// //console.log(this.goods)
		   		this.display();
			   }

	display(){
		console.log(this.res)
		console.log(this.goods)
		  
		var str="";
		for(var i=0;i<this.res.length;i++){
			for(var j=0;j<this.goods.length;j++){
				if(this.res[i].goodsId==this.goods[j].id){
					str+=` 
					<div class="body" index="${this.res[i].goodsId}">
						<div class="chose" >
						<input type="checkbox"class="check"/>
						</div>
						<div class="imga">
						<img src="${this.res[i].src}">
						</div>
						<div class="msg">
						<span  class="">
						 ${this.res[i].a1}
						</span>
						</div>
						<div class="pric">
						<span class="price">${this.res[i].a2}</span>
						</div>
						<div class="btnmt">
						<button class="small-button t2">-</button>
						<input class="count" type="text" size="2" value="${this.goods[j].num}" min="1">
						<button class="small-button">+</button>
						</div>
						<div class="unit ">
						<span class="priceCount" id="priceCount">${this.res[i].a2}</span>
						</div>
						<div class="cut">
						<a href="javascript:void(0);" class="t4 del">删除</a>
						</div>
					</div>`
				}
			}
		}
this.check=document.querySelector(".ckeck");
this.body.innerHTML=str;
this.render()
	//全选
this.all();
this.changecount();
	}
 }
   
new car();






	
	</script>
</html>
